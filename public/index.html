<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ë©”ì¸ í˜ì´ì§€ - ë¡œê·¸ì¸ & ê²Œì„ ì‹œì‘</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        text-align: center;
      }
      .container {
        max-width: 400px;
        margin: auto;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }
      input,
      button {
        width: 100%;
        padding: 10px;
        margin: 5px 0;
      }
      button {
        background-color: #007bff;
        color: white;
        border: none;
        cursor: pointer;
      }
      button:hover {
        background-color: #0056b3;
      }
      .hidden {
        display: none;
      }
      .logout-btn {
        background: red;
      }
    </style>
  </head>
  <body>
    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div class="container" id="loginScreen">
      <h2>ë¡œê·¸ì¸</h2>
      <input type="email" id="email" placeholder="ì´ë©”ì¼ ì…ë ¥" />
      <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" />
      <button onclick="login()">ë¡œê·¸ì¸</button>
      <p id="message"></p>
    </div>

    <!-- ê²Œì„ ì‹œì‘ í™”ë©´ -->
    <div class="container hidden" id="mainScreen">
      <h2>í™˜ì˜í•©ë‹ˆë‹¤!</h2>
      <button onclick="startGame()">ê²Œì„ ì‹œì‘</button>
      <button onclick="logout()" class="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        localStorage.removeItem('accessToken'); // ğŸš€ ê°•ì œ í† í° ì‚­ì œ
        checkAuth(); // ğŸš€ UI ì—…ë°ì´íŠ¸
      });

      function checkAuth() {
        const token = localStorage.getItem('accessToken');
        console.log('í˜„ì¬ í† í° ìƒíƒœ:', token); // ğŸš€ ë””ë²„ê¹…ìš©

        if (token) {
          document.getElementById('loginScreen').classList.add('hidden');
          document.getElementById('mainScreen').classList.remove('hidden');
        } else {
          document.getElementById('loginScreen').classList.remove('hidden');
          document.getElementById('mainScreen').classList.add('hidden');
        }
      }

      function login() {
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value.trim();

        if (!email || !password) {
          document.getElementById('message').textContent =
            'ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.';
          return;
        }

        fetch('http://localhost:3000/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password }),
          credentials: 'include',
        })
          .then((response) => {
            if (!response.ok) throw new Error('ë¡œê·¸ì¸ ì‹¤íŒ¨');
            return response
              .json()
              .then((data) => ({ data, headers: response.headers }));
          })
          .then(({ data, headers }) => {
            const accessToken = headers.get('Authorization');
            console.log('ë¡œê·¸ì¸ í† í°', accessToken);
            if (accessToken) {
              localStorage.setItem('accessToken', accessToken);
              document.getElementById('loginScreen').classList.add('hidden');
              document.getElementById('mainScreen').classList.remove('hidden');
            } else {
              throw new Error('í† í°ì´ ì—†ìŠµë‹ˆë‹¤.');
            }
          })
          .catch((error) => {
            document.getElementById('message').textContent =
              'ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + error.message;
          });
      }

      function startGame() {
        const token = localStorage.getItem('accessToken');
        if (!token) {
          alert('ë¡œê·¸ì¸ í›„ ê²Œì„ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
          return;
        }
        window.location.href = 'http://localhost:3000/game.html';
      }

      function logout() {
        localStorage.removeItem('accessToken'); // ğŸš€ ë°˜ë“œì‹œ í† í° ì œê±°

        document.getElementById('loginScreen').classList.remove('hidden');
        document.getElementById('mainScreen').classList.add('hidden');

        document.getElementById('email').value = '';
        document.getElementById('password').value = '';

        location.reload(); // ğŸš€ ê°•ì œ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ UI ì—…ë°ì´íŠ¸
      }
    </script>
  </body>
</html>
